<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TEE Private Chat Â· NEAR AI Cloud</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#05040a;
      --bg1:#070717;
      --bg2:#0c0b1f;
      --panel: rgba(10, 10, 24, 0.58);
      --panel2: rgba(10, 10, 24, 0.36);
      --stroke: rgba(255,255,255,0.10);
      --stroke2: rgba(255,255,255,0.16);

      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.66);
      --faint: rgba(255,255,255,0.50);

      --neonA:#7c3aed; /* violet */
      --neonB:#22d3ee; /* cyan */
      --neonC:#f97316; /* orange */
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;

      --radius-xl: 26px;
      --radius-lg: 18px;
      --radius-md: 14px;
      --radius-sm: 12px;
      --radius-xs: 10px;

      --s0: 6px;
      --s1: 10px;
      --s2: 14px;
      --s3: 18px;
      --s4: 24px;
      --s5: 32px;
      --s6: 40px;

      --shadow: 0 18px 70px rgba(0,0,0,0.55);
      --shadow2: 0 10px 30px rgba(0,0,0,0.35);

      --mono: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: "Syne", system-ui, -apple-system, Segoe UI, sans-serif;

      --focus: 0 0 0 3px rgba(34,211,238,0.18), 0 0 0 1px rgba(34,211,238,0.45) inset;
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background: radial-gradient(1200px 900px at 15% 10%, rgba(124,58,237,0.26), transparent 55%),
                  radial-gradient(900px 700px at 90% 20%, rgba(34,211,238,0.18), transparent 55%),
                  radial-gradient(800px 700px at 55% 95%, rgba(249,115,22,0.10), transparent 55%),
                  linear-gradient(180deg, var(--bg0), var(--bg1) 55%, var(--bg2));
      overflow: hidden;
    }

    /* Animated background: neon noir mesh + drifting grid + particles */
    .bg{
      position: fixed;
      inset: 0;
      pointer-events:none;
      z-index: 0;
    }
    .mesh{
      position:absolute;
      inset:-20%;
      background:
        radial-gradient(600px 480px at 20% 25%, rgba(124,58,237,0.26), transparent 60%),
        radial-gradient(520px 420px at 78% 18%, rgba(34,211,238,0.18), transparent 62%),
        radial-gradient(620px 520px at 70% 82%, rgba(249,115,22,0.12), transparent 60%),
        radial-gradient(520px 420px at 18% 85%, rgba(34,211,238,0.10), transparent 62%),
        radial-gradient(680px 520px at 48% 55%, rgba(124,58,237,0.12), transparent 68%);
      filter: blur(10px) saturate(1.2);
      animation: meshFloat 16s ease-in-out infinite;
      opacity: 0.95;
    }
    @keyframes meshFloat{
      0%{ transform: translate3d(-2%, -1%, 0) scale(1.03); }
      50%{ transform: translate3d(2%, 2%, 0) scale(1.06); }
      100%{ transform: translate3d(-2%, -1%, 0) scale(1.03); }
    }

    .grid{
      position:absolute;
      inset:0;
      background:
        linear-gradient(rgba(255,255,255,0.06) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.06) 1px, transparent 1px);
      background-size: 44px 44px;
      transform: perspective(900px) rotateX(56deg) translateY(160px) scale(1.15);
      transform-origin: 50% 0%;
      opacity: 0.12;
      filter: blur(0.2px);
      animation: gridDrift 9s linear infinite;
      mask-image: radial-gradient(80% 70% at 50% 35%, rgba(0,0,0,0.95), rgba(0,0,0,0.0));
      -webkit-mask-image: radial-gradient(80% 70% at 50% 35%, rgba(0,0,0,0.95), rgba(0,0,0,0.0));
    }
    @keyframes gridDrift{
      from{ background-position: 0 0, 0 0; }
      to{ background-position: 0 44px, 44px 0; }
    }

    canvas#particles{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      opacity: 0.55;
      mix-blend-mode: screen;
      filter: blur(0.1px);
    }

    .app{
      position: relative;
      z-index: 1;
      height: 100%;
      display: grid;
      grid-template-columns: 380px 1fr;
      gap: var(--s4);
      padding: var(--s5);
      max-width: 1440px;
      margin: 0 auto;
    }

    .panel{
      background: linear-gradient(180deg, rgba(12, 12, 28, 0.62), rgba(8, 8, 20, 0.46));
      border: 1px solid var(--stroke);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      overflow: hidden;
      position: relative;
    }

    .panel::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(700px 300px at 15% 8%, rgba(124,58,237,0.25), transparent 60%),
        radial-gradient(700px 350px at 85% 0%, rgba(34,211,238,0.18), transparent 62%),
        radial-gradient(700px 420px at 60% 105%, rgba(249,115,22,0.10), transparent 62%);
      opacity: 0.75;
      pointer-events:none;
      filter: blur(14px);
    }

    .sidebar{
      display:flex;
      flex-direction:column;
      min-width: 0;
    }

    .sidebarHeader{
      position: relative;
      padding: var(--s5) var(--s5) var(--s3);
      display:flex;
      flex-direction:column;
      gap: var(--s2);
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .brandRow{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: var(--s2);
    }

    .brand{
      display:flex;
      align-items:center;
      gap: var(--s2);
      min-width: 0;
    }
    .logo{
      width: 42px;
      height: 42px;
      border-radius: 14px;
      background:
        radial-gradient(circle at 35% 35%, rgba(34,211,238,0.85), rgba(34,211,238,0) 58%),
        radial-gradient(circle at 70% 70%, rgba(124,58,237,0.9), rgba(124,58,237,0) 60%),
        linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0));
      border: 1px solid rgba(255,255,255,0.16);
      box-shadow: 0 10px 30px rgba(124,58,237,0.18), 0 10px 28px rgba(34,211,238,0.12);
      position: relative;
      overflow:hidden;
    }
    .logo::after{
      content:"";
      position:absolute;
      inset:-40%;
      background: linear-gradient(115deg, transparent, rgba(255,255,255,0.28), transparent);
      transform: rotate(20deg);
      animation: sheen 6.5s ease-in-out infinite;
      opacity: 0.65;
    }
    @keyframes sheen{
      0%{ transform: translateX(-40%) rotate(20deg); }
      50%{ transform: translateX(40%) rotate(20deg); }
      100%{ transform: translateX(-40%) rotate(20deg); }
    }

    .brandText{
      display:flex;
      flex-direction:column;
      min-width:0;
    }
    .brandText .title{
      font-weight: 800;
      letter-spacing: 0.2px;
      font-size: 18px;
      line-height: 1.15;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .brandText .sub{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .pill{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      box-shadow: 0 12px 40px rgba(0,0,0,0.25);
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
      cursor: default;
      user-select:none;
      max-width: 180px;
    }
    .pill:hover{
      transform: translateY(-1px);
      border-color: rgba(34,211,238,0.32);
      background: rgba(34,211,238,0.08);
    }
    .dot{
      width: 10px;
      height: 10px;
      border-radius: 99px;
      background: var(--good);
      box-shadow: 0 0 0 0 rgba(52,211,153,0.0);
      position: relative;
    }
    .dot::after{
      content:"";
      position:absolute;
      inset:-10px;
      border-radius: 999px;
      background: radial-gradient(circle, rgba(52,211,153,0.30), rgba(52,211,153,0.0) 70%);
      animation: pulse 2.1s ease-in-out infinite;
    }
    @keyframes pulse{
      0%{ transform: scale(0.65); opacity: 0.55; }
      50%{ transform: scale(1.0); opacity: 0.25; }
      100%{ transform: scale(0.65); opacity: 0.55; }
    }
    .pill span{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--text);
      letter-spacing: 0.2px;
    }

    .sidebarBody{
      position: relative;
      padding: var(--s4) var(--s5) var(--s5);
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap: var(--s4);
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,0.18) transparent;
    }
    .sidebarBody::-webkit-scrollbar{ width: 10px; }
    .sidebarBody::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,0.14);
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,0);
      background-clip: padding-box;
    }

    .sectionTitle{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: var(--s2);
      margin-top: 2px;
    }
    .sectionTitle h3{
      margin:0;
      font-size: 14px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.78);
      font-weight: 800;
    }
    .dividerGlow{
      height: 1px;
      width: 100%;
      background: linear-gradient(90deg, rgba(124,58,237,0.0), rgba(124,58,237,0.40), rgba(34,211,238,0.35), rgba(249,115,22,0.0));
      opacity: 0.8;
    }

    .teeCard{
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.05);
      overflow:hidden;
      box-shadow: var(--shadow2);
      position: relative;
      transform: translateZ(0);
    }
    .teeCardHeader{
      padding: var(--s3) var(--s3);
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: var(--s2);
      border-bottom: 1px solid rgba(255,255,255,0.08);
      background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.03));
    }
    .teeCardHeader .left{
      display:flex; flex-direction:column; gap:4px;
      min-width:0;
    }
    .teeCardHeader .left .name{
      font-weight: 800;
      letter-spacing: 0.2px;
      font-size: 14px;
    }
    .teeCardHeader .left .desc{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .teeCardHeader .chip{
      display:flex; align-items:center; gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(34,211,238,0.22);
      background: rgba(34,211,238,0.08);
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,0.86);
      white-space:nowrap;
    }
    .chipIcon{
      width: 10px; height:10px; border-radius:999px;
      background: rgba(34,211,238,0.95);
      box-shadow: 0 0 18px rgba(34,211,238,0.35);
      position: relative;
    }
    .chipIcon::after{
      content:"";
      position:absolute;
      inset:-8px;
      border-radius:999px;
      background: radial-gradient(circle, rgba(34,211,238,0.22), rgba(34,211,238,0.0) 70%);
      animation: pulseCyan 1.6s ease-in-out infinite;
    }
    @keyframes pulseCyan{
      0%{ transform: scale(0.7); opacity:0.55; }
      55%{ transform: scale(1.02); opacity:0.22; }
      100%{ transform: scale(0.7); opacity:0.55; }
    }

    .teeList{
      padding: var(--s3);
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .teeItem{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: var(--s2);
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.10);
      transition: transform .16s ease, border-color .16s ease, background .16s ease;
      position: relative;
      overflow:hidden;
    }
    .teeItem:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
    }
    .teeItem .k{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width:0;
    }
    .sig{
      width: 26px; height: 26px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.12);
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      display:grid; place-items:center;
      color: rgba(255,255,255,0.82);
      font-family: var(--mono);
      font-weight: 700;
      font-size: 12px;
      position: relative;
    }
    .teeItem .label{
      display:flex; flex-direction:column;
      min-width:0;
    }
    .teeItem .label .a{
      font-weight: 700;
      font-size: 13px;
      color: rgba(255,255,255,0.86);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .teeItem .label .b{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,0.56);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .teeItem .state{
      display:flex;
      align-items:center;
      gap: 10px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,0.76);
      white-space:nowrap;
    }
    .state .tick{
      width: 20px;
      height: 20px;
      border-radius: 10px;
      display:grid;
      place-items:center;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
    }
    .tick.good{
      border-color: rgba(52,211,153,0.35);
      background: rgba(52,211,153,0.10);
      color: rgba(52,211,153,0.95);
      box-shadow: 0 0 0 0 rgba(52,211,153,0.0);
      animation: tickPulse 2.8s ease-in-out infinite;
    }
    @keyframes tickPulse{
      0%, 100%{ box-shadow: 0 0 0 0 rgba(52,211,153,0.0); }
      50%{ box-shadow: 0 0 0 8px rgba(52,211,153,0.06); }
    }
    .tick.bad{
      border-color: rgba(251,113,133,0.40);
      background: rgba(251,113,133,0.08);
      color: rgba(251,113,133,0.95);
      animation: badFlicker 3.2s ease-in-out infinite;
    }
    @keyframes badFlicker{
      0%, 100%{ opacity: 0.92; }
      50%{ opacity: 0.72; }
    }

    .howCard{
      padding: var(--s4);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.05);
      box-shadow: var(--shadow2);
      position: relative;
    }
    .howCard p{
      margin: 10px 0 0;
      color: rgba(255,255,255,0.72);
      font-size: 13px;
      line-height: 1.55;
    }
    .steps{
      margin-top: var(--s3);
      display:grid;
      gap: 10px;
    }
    .step{
      display:flex;
      gap: 12px;
      align-items:flex-start;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.18);
      transition: transform .16s ease, border-color .16s ease, background .16s ease;
    }
    .step:hover{
      transform: translateY(-1px);
      border-color: rgba(34,211,238,0.20);
      background: rgba(34,211,238,0.05);
    }
    .step .n{
      width: 28px; height: 28px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      font-family: var(--mono);
      font-weight: 700;
      font-size: 12px;
      color: rgba(255,255,255,0.86);
      border: 1px solid rgba(255,255,255,0.12);
      background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.03));
      flex: 0 0 auto;
    }
    .step .t{
      display:flex;
      flex-direction:column;
      gap: 2px;
      min-width:0;
    }
    .step .t b{
      font-size: 13px;
      font-weight: 800;
      color: rgba(255,255,255,0.86);
    }
    .step .t span{
      font-size: 12px;
      color: rgba(255,255,255,0.66);
      line-height: 1.45;
    }

    .codeCard{
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.30);
      overflow:hidden;
      box-shadow: var(--shadow2);
    }
    .codeTop{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      background: rgba(255,255,255,0.05);
    }
    .codeTop .label{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,0.72);
    }
    .btn{
      appearance:none;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.86);
      font-family: var(--mono);
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      transition: transform .16s ease, border-color .16s ease, background .16s ease;
      display:flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .btn:hover{
      transform: translateY(-1px);
      border-color: rgba(34,211,238,0.30);
      background: rgba(34,211,238,0.08);
    }
    .btn:active{ transform: translateY(0px) scale(0.99); }
    .btn:focus-visible{ outline: none; box-shadow: var(--focus); }

    pre{
      margin:0;
      padding: 14px;
      overflow:auto;
      font-family: var(--mono);
      font-size: 12px;
      line-height: 1.55;
      color: rgba(255,255,255,0.86);
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,0.18) transparent;
    }
    pre::-webkit-scrollbar{ height: 10px; width: 10px; }
    pre::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,0.14);
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,0);
      background-clip: padding-box;
    }

    .main{
      display:flex;
      flex-direction:column;
      min-width:0;
    }

    .mainHeader{
      padding: var(--s5) var(--s5) var(--s3);
      border-bottom: 1px solid rgba(255,255,255,0.08);
      display:flex;
      align-items:flex-end;
      justify-content: space-between;
      gap: var(--s3);
      position: relative;
    }
    .headline{
      display:flex;
      flex-direction:column;
      gap: 8px;
      min-width:0;
    }
    .headline h1{
      margin:0;
      font-size: 26px;
      letter-spacing: 0.2px;
      line-height: 1.1;
      font-weight: 800;
      background: linear-gradient(90deg, rgba(255,255,255,0.95), rgba(34,211,238,0.92), rgba(124,58,237,0.90));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .headline .tagline{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,0.66);
      max-width: 65ch;
    }

    .headerActions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      justify-content:flex-end;
    }
    .btnPrimary{
      border-color: rgba(124,58,237,0.35);
      background: rgba(124,58,237,0.12);
    }
    .btnPrimary:hover{
      border-color: rgba(124,58,237,0.50);
      background: rgba(124,58,237,0.18);
    }
    .btnDanger{
      border-color: rgba(251,113,133,0.35);
      background: rgba(251,113,133,0.10);
    }
    .btnDanger:hover{
      border-color: rgba(251,113,133,0.55);
      background: rgba(251,113,133,0.16);
    }

    .content{
      position: relative;
      flex:1;
      min-height:0;
      display:flex;
      flex-direction:column;
      padding: var(--s4) var(--s5) var(--s4);
      gap: var(--s3);
    }

    .welcome{
      border-radius: var(--radius-xl);
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.05);
      box-shadow: var(--shadow2);
      padding: var(--s5);
      position: relative;
      overflow:hidden;
      animation: popIn .35s ease both;
    }
    @keyframes popIn{
      from{ opacity:0; transform: translateY(8px) scale(0.99); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }

    .welcome.hidden{ display:none !important; }

    .welcome::before{
      content:"";
      position:absolute;
      inset:-1px;
      background:
        radial-gradient(900px 420px at 10% 10%, rgba(34,211,238,0.18), transparent 60%),
        radial-gradient(700px 420px at 85% 0%, rgba(124,58,237,0.18), transparent 62%),
        radial-gradient(700px 520px at 60% 120%, rgba(249,115,22,0.10), transparent 62%);
      filter: blur(16px);
      opacity: 0.85;
      pointer-events:none;
    }
    .welcomeInner{
      position: relative;
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: var(--s4);
    }
    .welcome h2{
      margin:0;
      font-size: 18px;
      letter-spacing: 0.2px;
      font-weight: 800;
      color: rgba(255,255,255,0.92);
    }
    .welcome p{
      margin: 10px 0 0;
      color: rgba(255,255,255,0.72);
      line-height: 1.6;
      font-size: 13px;
      max-width: 78ch;
    }
    .hintRow{
      margin-top: var(--s3);
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .hint{
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.22);
      padding: 10px 12px;
      border-radius: 16px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,0.74);
      transition: transform .16s ease, border-color .16s ease, background .16s ease;
      cursor:pointer;
      user-select:none;
    }
    .hint:hover{
      transform: translateY(-1px);
      border-color: rgba(34,211,238,0.24);
      background: rgba(34,211,238,0.06);
    }
    .hint:active{ transform: translateY(0px) scale(0.99); }

    .chat{
      flex: 1;
      min-height: 0;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap: 12px;
      padding: 4px 2px 8px;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,0.18) transparent;
    }
    .chat::-webkit-scrollbar{ width: 10px; }
    .chat::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,0.14);
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,0);
      background-clip: padding-box;
    }

    .msgRow{
      display:flex;
      gap: 10px;
      align-items:flex-end;
      animation: msgIn .22s ease both;
    }
    @keyframes msgIn{
      from{ opacity:0; transform: translateY(6px); }
      to{ opacity:1; transform: translateY(0); }
    }

    .msgRow.user{ justify-content:flex-end; }
    .msgRow.ai{ justify-content:flex-start; }

    .avatar{
      width: 34px; height: 34px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      display:grid; place-items:center;
      box-shadow: 0 10px 26px rgba(0,0,0,0.25);
      flex: 0 0 auto;
      position: relative;
      overflow:hidden;
    }
    .avatar.ai{
      background:
        radial-gradient(circle at 35% 35%, rgba(34,211,238,0.85), rgba(34,211,238,0) 58%),
        radial-gradient(circle at 70% 70%, rgba(124,58,237,0.8), rgba(124,58,237,0) 62%),
        rgba(255,255,255,0.04);
      border-color: rgba(34,211,238,0.22);
    }
    .avatar.user{
      background:
        radial-gradient(circle at 35% 35%, rgba(249,115,22,0.70), rgba(249,115,22,0) 58%),
        radial-gradient(circle at 70% 70%, rgba(124,58,237,0.65), rgba(124,58,237,0) 62%),
        rgba(255,255,255,0.04);
      border-color: rgba(249,115,22,0.20);
    }
    .avatar span{
      font-family: var(--mono);
      font-size: 12px;
      font-weight: 700;
      color: rgba(255,255,255,0.86);
    }

    .bubble{
      max-width: min(720px, 78%);
      border-radius: 18px;
      padding: 12px 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      box-shadow: 0 14px 40px rgba(0,0,0,0.32);
      position: relative;
      overflow:hidden;
      transition: transform .16s ease, border-color .16s ease, background .16s ease;
      transform: translateZ(0);
    }
    .bubble:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.08);
    }
    .bubble.user{
      background: rgba(249,115,22,0.08);
      border-color: rgba(249,115,22,0.20);
    }
    .bubble.ai{
      background: rgba(34,211,238,0.07);
      border-color: rgba(34,211,238,0.22);
    }
    .bubble .text{
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 14px;
      line-height: 1.6;
      color: rgba(255,255,255,0.86);
    }
    .meta{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      color: rgba(255,255,255,0.56);
      font-family: var(--mono);
      font-size: 11px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(34,211,238,0.20);
      background: rgba(34,211,238,0.08);
      color: rgba(255,255,255,0.72);
      white-space:nowrap;
    }
    .badge .lock{
      filter: drop-shadow(0 0 14px rgba(34,211,238,0.25));
    }

    .time{
      opacity: 0.75;
      white-space:nowrap;
    }

    .composer{
      border-top: 1px solid rgba(255,255,255,0.08);
      padding: var(--s3) var(--s5) var(--s5);
      display:flex;
      gap: 12px;
      align-items:flex-end;
      background: linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.12));
    }
    .inputWrap{
      flex:1;
      min-width: 0;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      box-shadow: 0 14px 50px rgba(0,0,0,0.32);
      padding: 10px 10px 10px 12px;
      display:flex;
      gap: 10px;
      align-items:flex-end;
      transition: border-color .16s ease, background .16s ease, transform .16s ease;
    }
    .inputWrap:focus-within{
      border-color: rgba(34,211,238,0.32);
      background: rgba(34,211,238,0.06);
      box-shadow: var(--focus), 0 18px 70px rgba(0,0,0,0.42);
      transform: translateY(-1px);
    }
    textarea{
      flex:1;
      min-width: 0;
      resize: none;
      border: none;
      outline: none;
      background: transparent;
      color: rgba(255,255,255,0.88);
      font-family: var(--sans);
      font-size: 14px;
      line-height: 1.5;
      max-height: 160px;
      padding: 2px 0;
    }
    textarea::placeholder{ color: rgba(255,255,255,0.46); }
    .kbd{
      flex: 0 0 auto;
      display:flex;
      align-items:center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.18);
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,0.60);
      user-select:none;
    }
    .kbd .key{
      padding: 2px 8px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.72);
      font-weight: 700;
    }

    .sendBtn{
      flex: 0 0 auto;
      min-width: 54px;
      height: 54px;
      border-radius: 18px;
      border: 1px solid rgba(34,211,238,0.28);
      background: rgba(34,211,238,0.10);
      box-shadow: 0 14px 50px rgba(0,0,0,0.32);
      cursor:pointer;
      transition: transform .16s ease, border-color .16s ease, background .16s ease, box-shadow .16s ease;
      display:grid;
      place-items:center;
      color: rgba(255,255,255,0.86);
    }
    .sendBtn:hover{
      transform: translateY(-1px);
      border-color: rgba(34,211,238,0.45);
      background: rgba(34,211,238,0.16);
      box-shadow: 0 18px 65px rgba(0,0,0,0.40), 0 0 0 6px rgba(34,211,238,0.07);
    }
    .sendBtn:active{ transform: translateY(0px) scale(0.99); }
    .sendBtn:focus-visible{ outline:none; box-shadow: var(--focus), 0 18px 65px rgba(0,0,0,0.40); }
    .sendBtn[disabled]{
      opacity: 0.55;
      cursor: not-allowed;
      transform:none;
      box-shadow: 0 14px 50px rgba(0,0,0,0.32);
    }

    .typingRow{
      display:flex;
      gap: 10px;
      align-items:flex-end;
      justify-content:flex-start;
      padding-left: 2px;
      animation: msgIn .22s ease both;
    }
    .typingBubble{
      border-radius: 18px;
      padding: 12px 14px;
      border: 1px solid rgba(34,211,238,0.22);
      background: rgba(34,211,238,0.07);
      box-shadow: 0 14px 40px rgba(0,0,0,0.32);
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .dots{
      display:flex;
      gap: 6px;
      align-items:center;
    }
    .dotty{
      width: 8px; height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.70);
      opacity: 0.55;
      animation: dotBounce 1.0s ease-in-out infinite;
    }
    .dotty:nth-child(2){ animation-delay: 0.14s; }
    .dotty:nth-child(3){ animation-delay: 0.28s; }
    @keyframes dotBounce{
      0%, 100%{ transform: translateY(0px); opacity: 0.45; }
      50%{ transform: translateY(-4px); opacity: 0.95; }
    }
    .typingLabel{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,0.68);
      white-space:nowrap;
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 22px;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.55);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 999px;
      padding: 10px 14px;
      color: rgba(255,255,255,0.82);
      font-family: var(--mono);
      font-size: 12px;
      box-shadow: 0 18px 70px rgba(0,0,0,0.55);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      opacity: 0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      z-index: 5;
      max-width: min(820px, calc(100% - 24px));
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-6px);
    }

    /* Responsive */
    @media (max-width: 1060px){
      body{ overflow:auto; }
      .app{
        grid-template-columns: 1fr;
        padding: var(--s4);
        gap: var(--s4);
        height: auto;
        min-height: 100%;
      }
      .sidebar{ order: 2; }
      .main{ order: 1; min-height: 72vh; }
      .bubble{ max-width: 92%; }
      .headline h1{ white-space: normal; }
    }
    @media (max-width: 560px){
      .app{ padding: 16px; }
      .sidebarHeader, .mainHeader{ padding: 18px 18px 12px; }
      .sidebarBody{ padding: 16px 18px 18px; }
      .content{ padding: 16px 18px; }
      .composer{ padding: 12px 18px 18px; }
      .pill{ max-width: none; }
      .kbd{ display:none; }
      .sendBtn{ height: 52px; min-width: 52px; border-radius: 18px; }
      .welcome{ padding: 18px; }
    }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true">
    <div class="mesh"></div>
    <div class="grid"></div>
    <canvas id="particles"></canvas>
  </div>

  <div class="app">
    <aside class="panel sidebar" aria-label="TEE status and explanation">
      <div class="sidebarHeader">
        <div class="brandRow">
          <div class="brand">
            <div class="logo" aria-hidden="true"></div>
            <div class="brandText">
              <div class="title">TEE Private Chat</div>
              <div class="sub">Enterprise-grade privacy Â· trivial build</div>
            </div>
          </div>
          <div class="pill" title="Live TEE link status">
            <div class="dot"></div>
            <span>TEE LINK: LIVE</span>
          </div>
        </div>
      </div>

      <div class="sidebarBody">
        <div class="sectionTitle">
          <h3>TEE Status</h3>
        </div>
        <div class="dividerGlow"></div>

        <div class="teeCard" role="group" aria-label="Trusted Execution Environment indicators">
          <div class="teeCardHeader">
            <div class="left">
              <div class="name">Cryptographic Privacy Signals</div>
              <div class="desc">Visible proof points Â· calm, constant assurance</div>
            </div>
            <div class="chip" title="NEAR AI Cloud Â· TEE protected">
              <span class="chipIcon" aria-hidden="true"></span>
              <span>NEAR AI Cloud</span>
            </div>
          </div>
          <div class="teeList">
            <div class="teeItem">
              <div class="k">
                <div class="sig">E</div>
                <div class="label">
                  <div class="a">Encryption: AES-256-GCM</div>
                  <div class="b">your prompt sealed in transit + at runtime</div>
                </div>
              </div>
              <div class="state">
                <div class="tick good">âœ“</div>
              </div>
            </div>

            <div class="teeItem">
              <div class="k">
                <div class="sig">A</div>
                <div class="label">
                  <div class="a">Attestation: Verified</div>
                  <div class="b">hardware-backed proof itâ€™s the right enclave</div>
                </div>
              </div>
              <div class="state">
                <div class="tick good">âœ“</div>
              </div>
            </div>

            <div class="teeItem">
              <div class="k">
                <div class="sig">O</div>
                <div class="label">
                  <div class="a">Operator Access: BLOCKED</div>
                  <div class="b">server operators canâ€™t read prompt or output</div>
                </div>
              </div>
              <div class="state">
                <div class="tick bad">âœ—</div>
              </div>
            </div>

            <div class="teeItem">
              <div class="k">
                <div class="sig">I</div>
                <div class="label">
                  <div class="a">Inference: On-Chain TEE</div>
                  <div class="b">sealed compute with verifiable execution</div>
                </div>
              </div>
              <div class="state">
                <div class="tick good">âœ“</div>
              </div>
            </div>
          </div>
        </div>

        <div class="sectionTitle">
          <h3>How It Works</h3>
        </div>
        <div class="dividerGlow"></div>

        <div class="howCard">
          <p>
            Meta-narrative: enterprise-grade cryptographic privacy, trivially simple to build.
            Your prompt goes into a hardware-isolated enclave; the operator never sees it.
          </p>
          <div class="steps" aria-label="How TEE works steps">
            <div class="step">
              <div class="n">1</div>
              <div class="t">
                <b>You send a prompt.</b>
                <span>Itâ€™s encrypted and routed to a trusted enclave on NEAR AI Cloud.</span>
              </div>
            </div>
            <div class="step">
              <div class="n">2</div>
              <div class="t">
                <b>The enclave proves itself.</b>
                <span>Remote attestation verifies the exact secure environment before compute runs.</span>
              </div>
            </div>
            <div class="step">
              <div class="n">3</div>
              <div class="t">
                <b>Inference runs privately.</b>
                <span>The model processes your text inside the enclave; the operator is blocked by design.</span>
              </div>
            </div>
            <div class="step">
              <div class="n">4</div>
              <div class="t">
                <b>You receive the answer.</b>
                <span>The response returns to you, still protected by the same cryptographic guarantees.</span>
              </div>
            </div>
          </div>
        </div>

        <div class="sectionTitle">
          <h3>3-Line Integration</h3>
          <button class="btn" id="copyCodeBtn" type="button" title="Copy snippet">
            <span style="font-family:var(--mono)">â§‰</span>
            Copy
          </button>
        </div>
        <div class="dividerGlow"></div>

        <div class="codeCard">
          <div class="codeTop">
            <div class="label">Near AI Cloud (TEE protection is automatic)</div>
            <button class="btn btnPrimary" id="copyFetchBtn" type="button" title="Copy fetch example">
              <span style="font-family:var(--mono)">â§‰</span>
              Copy fetch
            </button>
          </div>
          <pre id="codeSnippet">// 3-line NEAR AI Cloud integration:
const ai = new OpenAI({ baseURL: 'https://cloud-api.near.ai/v1', apiKey: YOUR_KEY })
// TEE protection is automatic. No special SDK needed.</pre>
        </div>

      </div>
    </aside>

    <main class="panel main" aria-label="Private chat">
      <div class="mainHeader">
        <div class="headline">
          <h1>Cryptographically Private AI Chat</h1>
          <div class="tagline">Powered by NEAR AI Cloud TEEs. Your prompts are sealedâ€”never visible to any server operator.</div>
        </div>
        <div class="headerActions">
          <button class="btn" id="exportBtn" type="button" title="Export chat to a JSON file">
            <span style="font-family:var(--mono)">â‡£</span>
            Export
          </button>
          <button class="btn btnDanger" id="clearBtn" type="button" title="Clear local chat history">
            <span style="font-family:var(--mono)">âŒ«</span>
            Clear
          </button>
        </div>
      </div>

      <div class="content">
        <section class="welcome" id="welcome">
          <div class="welcomeInner">
            <div>
              <h2>Say something sensitive. Thatâ€™s the point.</h2>
              <p>
                This chat is designed for privacy-by-default: the runtime is a Trusted Execution Environment (TEE).
                You get the UX of a simple chat, with the assurance of enterprise cryptography under the hood.
              </p>
              <div class="hintRow" aria-label="Quick prompt ideas">
                <div class="hint" data-hint="Draft a confidential email to my CFO about a pending acquisition. Keep it concise and professional.">Confidential CFO email</div>
                <div class="hint" data-hint="Explain what a TEE is in one paragraph for non-technical executives, focusing on operator-blindness.">TEE for executives</div>
                <div class="hint" data-hint="Rewrite this with stronger privacy language: â€œWe do not store prompts.â€">Privacy copywriting</div>
                <div class="hint" data-hint="Iâ€™m preparing a security review. Provide a checklist for assessing TEE-based AI inference vendors.">Security checklist</div>
              </div>
            </div>
          </div>
        </section>

        <div class="chat" id="chat" aria-live="polite" aria-label="Chat messages"></div>

        <div class="typingRow" id="typingRow" style="display:none" aria-hidden="true">
          <div class="avatar ai"><span>AI</span></div>
          <div class="typingBubble">
            <div class="dots" aria-hidden="true">
              <div class="dotty"></div>
              <div class="dotty"></div>
              <div class="dotty"></div>
            </div>
            <div class="typingLabel">TEE-secured inference in progressâ€¦</div>
          </div>
        </div>
      </div>

      <div class="composer" role="group" aria-label="Message composer">
        <div class="inputWrap">
          <textarea id="prompt" rows="1" placeholder="Type a private promptâ€¦ (Shift+Enter for new line)"></textarea>
          <div class="kbd" title="Keyboard shortcuts">
            <span class="key">Enter</span><span>send</span>
            <span style="opacity:.6">Â·</span>
            <span class="key">Shift</span><span>+ Enter</span><span>newline</span>
          </div>
        </div>
        <button class="sendBtn" id="sendBtn" type="button" title="Send message">
          <span style="font-family:var(--mono); font-weight:800;">â†—</span>
        </button>
      </div>
    </main>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // ---------- Utility ----------
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const chatEl = $("#chat");
    const promptEl = $("#prompt");
    const sendBtn = $("#sendBtn");
    const welcomeEl = $("#welcome");
    const typingRow = $("#typingRow");
    const toastEl = $("#toast");

    const STORAGE_KEY = "tee_private_chat_v1";
    const SYS_PROMPT = [
      "You are a privacy-focused assistant for an enterprise TEE chat demo.",
      "Be concise, clear, and helpful.",
      "If the user asks about how privacy works, explain TEEs in plain English and mention that prompts are not visible to server operators.",
      "Avoid claiming anything not stated: you are running via NEAR AI Cloud using a Trusted Execution Environment (TEE)."
    ].join("\n");

    function nowTime(){
      const d = new Date();
      return d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    function toast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      clearTimeout(toast._t);
      toast._t = setTimeout(()=> toastEl.classList.remove("show"), 1600);
    }

    function escapeHTML(str){
      return str.replace(/[&<>"']/g, (m)=>({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[m]));
    }

    function scrollToBottom(smooth=true){
      const behavior = smooth ? "smooth" : "auto";
      chatEl.scrollTo({ top: chatEl.scrollHeight + 2000, behavior });
    }

    function setWaiting(isWaiting){
      sendBtn.disabled = isWaiting;
      promptEl.disabled = isWaiting;
      typingRow.style.display = isWaiting ? "flex" : "none";
      typingRow.setAttribute("aria-hidden", isWaiting ? "false" : "true");
      if(isWaiting) scrollToBottom(true);
    }

    function autosize(){
      promptEl.style.height = "auto";
      const max = 160;
      const h = Math.min(max, promptEl.scrollHeight);
      promptEl.style.height = h + "px";
    }

    // ---------- Rendering ----------
    function addMessageToDOM(msg){
      const row = document.createElement("div");
      row.className = `msgRow ${msg.role === "user" ? "user" : "ai"}`;

      const avatar = document.createElement("div");
      avatar.className = `avatar ${msg.role === "user" ? "user" : "ai"}`;
      const avText = document.createElement("span");
      avText.textContent = msg.role === "user" ? "YOU" : "AI";
      avatar.appendChild(avText);

      const bubble = document.createElement("div");
      bubble.className = `bubble ${msg.role === "user" ? "user" : "ai"}`;

      const text = document.createElement("div");
      text.className = "text";
      text.textContent = msg.content;

      const meta = document.createElement("div");
      meta.className = "meta";

      const time = document.createElement("div");
      time.className = "time";
      time.textContent = msg.time || nowTime();

      if(msg.role === "assistant"){
        const badge = document.createElement("div");
        badge.className = "badge";
        badge.innerHTML = `<span class="lock">ðŸ”’</span><span>TEE-secured Â· NEAR AI Cloud</span>`;
        meta.appendChild(badge);
        meta.appendChild(time);
      } else {
        meta.appendChild(document.createElement("div"));
        meta.appendChild(time);
      }

      bubble.appendChild(text);
      bubble.appendChild(meta);

      if(msg.role === "assistant"){
        row.appendChild(avatar);
        row.appendChild(bubble);
      } else {
        row.appendChild(bubble);
        row.appendChild(avatar);
      }

      chatEl.appendChild(row);
      scrollToBottom(true);
    }

    function setWelcomeHiddenIfNeeded(messages){
      if(messages.length > 0){
        welcomeEl.classList.add("hidden");
      } else {
        welcomeEl.classList.remove("hidden");
      }
    }

    // ---------- Persistence ----------
    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return { messages: [] };
        const parsed = JSON.parse(raw);
        if(!parsed || !Array.isArray(parsed.messages)) return { messages: [] };
        return parsed;
      }catch{
        return { messages: [] };
      }
    }

    function saveState(state){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    const state = loadState();

    function rerender(){
      chatEl.innerHTML = "";
      for(const m of state.messages) addMessageToDOM(m);
      setWelcomeHiddenIfNeeded(state.messages);
      scrollToBottom(false);
    }

    // ---------- NEAR AI Cloud Inference ----------
    async function callNearAI(messages){
      const payload = {
        model: "deepseek-ai/DeepSeek-V3.1",
        messages,
        max_tokens: 1024
      };

      const res = await fetch("https://cloud-api.near.ai/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer sk-158842bdda7b4d13857e201777c11dc7"
        },
        body: JSON.stringify(payload)
      });

      if(!res.ok){
        const txt = await res.text().catch(()=> "");
        throw new Error(`NEAR AI Cloud error ${res.status}: ${txt || res.statusText}`);
      }

      const data = await res.json();
      const content = data?.choices?.[0]?.message?.content;
      if(!content) throw new Error("Empty response from NEAR AI Cloud.");
      return content;
    }

    function buildModelMessages(){
      // Keep conversation compact but useful.
      const MAX = 18;
      const recent = state.messages.slice(-MAX).map(m => ({
        role: m.role === "assistant" ? "assistant" : "user",
        content: m.content
      }));

      // System message must come first
      return [{ role: "system", content: SYS_PROMPT }, ...recent];
    }

    async function send(){
      const text = promptEl.value.trim();
      if(!text) return;

      // Add user message
      const userMsg = { role: "user", content: text, time: nowTime() };
      state.messages.push(userMsg);
      saveState(state);
      addMessageToDOM(userMsg);
      setWelcomeHiddenIfNeeded(state.messages);

      promptEl.value = "";
      autosize();

      setWaiting(true);

      try{
        const modelMessages = buildModelMessages();
        const answer = await callNearAI(modelMessages);

        const aiMsg = { role: "assistant", content: answer.trim(), time: nowTime() };
        state.messages.push(aiMsg);
        saveState(state);
        addMessageToDOM(aiMsg);
      }catch(err){
        const aiMsg = {
          role: "assistant",
          content: `I couldnâ€™t reach the TEE inference endpoint.\n\nDetails: ${String(err.message || err)}\n\nTip: In production, the app injects your NEAR AI key at deploy time.`,
          time: nowTime()
        };
        state.messages.push(aiMsg);
        saveState(state);
        addMessageToDOM(aiMsg);
      }finally{
        setWaiting(false);
        promptEl.focus();
      }
    }

    // ---------- Actions ----------
    $("#clearBtn").addEventListener("click", ()=>{
      if(!confirm("Clear local chat history on this device?")) return;
      state.messages = [];
      saveState(state);
      rerender();
      toast("Cleared local history.");
      promptEl.focus();
    });

    $("#exportBtn").addEventListener("click", ()=>{
      const blob = new Blob([JSON.stringify({
        exported_at: new Date().toISOString(),
        messages: state.messages
      }, null, 2)], { type: "application/json" });

      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "tee-private-chat-export.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=> URL.revokeObjectURL(a.href), 1500);
      toast("Exported chat JSON.");
    });

    $("#copyCodeBtn").addEventListener("click", async ()=>{
      const text = $("#codeSnippet").textContent;
      try{
        await navigator.clipboard.writeText(text);
        toast("Copied snippet.");
      }catch{
        toast("Copy failed (clipboard blocked).");
      }
    });

    $("#copyFetchBtn").addEventListener("click", async ()=>{
      const snippet =
`fetch('https://cloud-api.near.ai/v1/chat/completions', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer YOUR_KEY' },
  body: JSON.stringify({ model: 'deepseek-ai/DeepSeek-V3.1', messages, max_tokens: 1024 })
}).then(r=>r.json()).then(d=>d.choices[0].message.content)`;
      try{
        await navigator.clipboard.writeText(snippet);
        toast("Copied fetch example.");
      }catch{
        toast("Copy failed (clipboard blocked).");
      }
    });

    $$(".hint").forEach(h=>{
      h.addEventListener("click", ()=>{
        const v = h.getAttribute("data-hint") || "";
        promptEl.value = v;
        autosize();
        promptEl.focus();
        toast("Prompt inserted.");
      });
    });

    // Composer interactions
    promptEl.addEventListener("input", autosize);

    promptEl.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        if(!sendBtn.disabled) send();
      }
    });

    sendBtn.addEventListener("click", ()=> send());

    // ---------- Particles background ----------
    (function particles(){
      const canvas = document.getElementById("particles");
      const ctx = canvas.getContext("2d", { alpha: true });
      let w=0,h=0,dpr=1;

      const colors = [
        { r: 34, g: 211, b: 238, a: 0.45 }, // cyan
        { r: 124, g: 58, b: 237, a: 0.42 }, // violet
        { r: 249, g: 115, b: 22, a: 0.30 }  // orange
      ];

      const N = 86;
      const P = [];
      function rnd(a,b){ return a + Math.random()*(b-a); }

      function resize(){
        dpr = Math.min(2, window.devicePixelRatio || 1);
        w = canvas.clientWidth = canvas.parentElement.clientWidth;
        h = canvas.clientHeight = canvas.parentElement.clientHeight;
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }

      function init(){
        P.length = 0;
        for(let i=0;i<N;i++){
          const c = colors[Math.floor(Math.random()*colors.length)];
          P.push({
            x: rnd(0,w),
            y: rnd(0,h),
            r: rnd(1.2, 3.2),
            vx: rnd(-0.25,0.25),
            vy: rnd(-0.18,0.18),
            c,
            tw: rnd(0, Math.PI*2),
            ts: rnd(0.004, 0.018),
          });
        }
      }

      function draw(){
        ctx.clearRect(0,0,w,h);

        // subtle links
        for(let i=0;i<P.length;i++){
          for(let j=i+1;j<P.length;j++){
            const a = P[i], b = P[j];
            const dx = a.x - b.x;
            const dy = a.y - b.y;
            const dist = Math.hypot(dx,dy);
            if(dist < 140){
              const alpha = (1 - dist/140) * 0.10;
              ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
              ctx.lineWidth = 1;
              ctx.beginPath();
              ctx.moveTo(a.x, a.y);
              ctx.lineTo(b.x, b.y);
              ctx.stroke();
            }
          }
        }

        for(const p of P){
          p.tw += p.ts;
          const pulse = (Math.sin(p.tw)+1)/2; // 0..1
          const rr = p.r * (0.85 + pulse*0.55);
          const a = p.c.a * (0.55 + pulse*0.6);

          const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, rr*8.2);
          grad.addColorStop(0, `rgba(${p.c.r},${p.c.g},${p.c.b},${a})`);
          grad.addColorStop(1, `rgba(${p.c.r},${p.c.g},${p.c.b},0)`);
          ctx.fillStyle = grad;
          ctx.beginPath();
          ctx.arc(p.x, p.y, rr*8.2, 0, Math.PI*2);
          ctx.fill();

          // core
          ctx.fillStyle = `rgba(255,255,255,${0.22 + pulse*0.25})`;
          ctx.beginPath();
          ctx.arc(p.x, p.y, rr*0.95, 0, Math.PI*2);
          ctx.fill();

          p.x += p.vx;
          p.y += p.vy;

          if(p.x < -40) p.x = w + 40;
          if(p.x > w + 40) p.x = -40;
          if(p.y < -40) p.y = h + 40;
          if(p.y > h + 40) p.y = -40;
        }

        requestAnimationFrame(draw);
      }

      const ro = new ResizeObserver(()=>{ resize(); init(); });
      ro.observe(document.body);
      resize(); init(); draw();
    })();

    // ---------- Boot ----------
    rerender();
    autosize();
    promptEl.focus();

    // If there's no history, seed one subtle assistant message on first load? Keep it truly empty.
    // But add a tiny toast hint for first-time users.
    if(state.messages.length === 0){
      setTimeout(()=> toast("Your prompt is protected inside a TEE. Operators canâ€™t read it."), 650);
    }
  </script>
</body>
</html>