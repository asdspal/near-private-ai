<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TEE Private Chat Â· NEAR AI Cloud</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@300;400;600;700&family=VT323&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg0:#06060a;
      --bg1:#0b0b12;
      --panel: rgba(14, 14, 22, .62);
      --panel2: rgba(14, 14, 22, .78);
      --stroke: rgba(255,255,255,.12);
      --stroke2: rgba(120,255,255,.22);
      --text: rgba(240,245,255,.92);
      --muted: rgba(240,245,255,.62);
      --faint: rgba(240,245,255,.38);
      --good: #51ffb0;
      --warn: #ffdb6e;
      --bad:  #ff4d7d;
      --cyan: #52f8ff;
      --pink: #ff4df3;
      --violet: #a46bff;
      --blue: #1e6bff;

      --r-lg: 22px;
      --r-md: 16px;
      --r-sm: 12px;
      --r-xs: 10px;

      --s-1: 6px;
      --s-2: 10px;
      --s-3: 14px;
      --s-4: 18px;
      --s-5: 24px;
      --s-6: 32px;

      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 12px 30px rgba(0,0,0,.45);
      --glow: 0 0 0 1px rgba(82,248,255,.25), 0 0 28px rgba(82,248,255,.14), 0 0 70px rgba(255,77,243,.08);
      --glow2: 0 0 0 1px rgba(255,255,255,.10), 0 0 18px rgba(82,248,255,.10);

      --font-display: "Unbounded", system-ui, -apple-system, Segoe UI, sans-serif;
      --font-mono: "VT323", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;

      --ring: 0 0 0 3px rgba(82,248,255,.18), 0 0 0 1px rgba(82,248,255,.35) inset;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family: var(--font-display);
      background: radial-gradient(1200px 900px at 15% 15%, rgba(82,248,255,.12), transparent 55%),
                  radial-gradient(900px 700px at 88% 24%, rgba(255,77,243,.12), transparent 52%),
                  radial-gradient(900px 900px at 70% 90%, rgba(164,107,255,.10), transparent 58%),
                  linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
    }

    /* Animated background: neon noir gradient mesh + drifting grid */
    .bg{
      position:fixed; inset:0;
      pointer-events:none;
      overflow:hidden;
    }
    .mesh{
      position:absolute; inset:-15%;
      filter: blur(22px) saturate(1.2);
      opacity:.9;
      background:
        radial-gradient(500px 420px at 20% 30%, rgba(82,248,255,.18), transparent 65%),
        radial-gradient(480px 430px at 65% 20%, rgba(255,77,243,.16), transparent 62%),
        radial-gradient(520px 470px at 72% 72%, rgba(164,107,255,.14), transparent 66%),
        radial-gradient(520px 420px at 28% 78%, rgba(30,107,255,.12), transparent 65%);
      animation: meshFloat 12s ease-in-out infinite alternate;
      transform: translate3d(0,0,0);
    }
    @keyframes meshFloat{
      0%{ transform: translate3d(-1.5%, -1%, 0) scale(1.02) rotate(-.6deg); }
      50%{ transform: translate3d(1.5%, 1%, 0) scale(1.03) rotate(.8deg); }
      100%{ transform: translate3d(-1%, 1.5%, 0) scale(1.02) rotate(-.2deg); }
    }

    .grid{
      position:absolute; inset:0;
      opacity:.22;
      background-image:
        linear-gradient(rgba(82,248,255,.12) 1px, transparent 1px),
        linear-gradient(90deg, rgba(82,248,255,.10) 1px, transparent 1px);
      background-size: 44px 44px, 44px 44px;
      transform: perspective(900px) rotateX(58deg) translateY(120px);
      transform-origin: bottom;
      filter: drop-shadow(0 0 18px rgba(82,248,255,.18));
      animation: gridDrift 10s linear infinite;
      mask-image: linear-gradient(to top, rgba(0,0,0,1), rgba(0,0,0,.55) 55%, rgba(0,0,0,0));
    }
    @keyframes gridDrift{
      0%{ background-position: 0px 0px, 0px 0px; }
      100%{ background-position: 0px 180px, 0px 180px; }
    }

    .vignette{
      position:absolute; inset:0;
      background:
        radial-gradient(1200px 900px at 50% 40%, transparent 35%, rgba(0,0,0,.62) 100%);
      opacity:.65;
      mix-blend-mode:multiply;
    }

    .app{
      position:relative;
      height:100%;
      display:flex;
      gap:var(--s-4);
      padding: clamp(14px, 2.3vw, 24px);
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border: 1px solid var(--stroke);
      border-radius: var(--r-lg);
      box-shadow: var(--shadow), var(--glow);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    .sidebar{
      width: 360px;
      min-width: 280px;
      max-width: 380px;
      padding: var(--s-5);
      display:flex;
      flex-direction:column;
      gap: var(--s-5);
      position:relative;
      overflow:hidden;
    }
    .sidebar:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(420px 220px at 20% 10%, rgba(82,248,255,.16), transparent 60%),
        radial-gradient(380px 260px at 80% 25%, rgba(255,77,243,.12), transparent 62%),
        radial-gradient(380px 280px at 55% 95%, rgba(164,107,255,.10), transparent 65%);
      opacity:.9;
      pointer-events:none;
      filter: blur(12px);
    }
    .sidebar > *{ position:relative; z-index:1; }

    .brand{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: var(--s-4);
    }
    .brand .title{
      display:flex; flex-direction:column; gap: var(--s-2);
      line-height:1.05;
    }
    .logo{
      width:44px; height:44px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(82,248,255,.25), rgba(255,77,243,.18));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 0 0 1px rgba(82,248,255,.18) inset, 0 12px 30px rgba(0,0,0,.35);
      display:grid; place-items:center;
      flex: 0 0 auto;
      position:relative;
      overflow:hidden;
    }
    .logo:after{
      content:"";
      position:absolute; inset:-40%;
      background: conic-gradient(from 120deg, rgba(82,248,255,.0), rgba(82,248,255,.55), rgba(255,77,243,.45), rgba(164,107,255,.35), rgba(82,248,255,.0));
      animation: spin 5.2s linear infinite;
      opacity:.55;
    }
    @keyframes spin{ to{ transform: rotate(360deg);} }
    .logo svg{ width:22px; height:22px; z-index:1; filter: drop-shadow(0 6px 14px rgba(0,0,0,.55)); }

    .h1{
      font-weight: 700;
      letter-spacing: .2px;
      font-size: 18px;
    }
    .sub{
      color: var(--muted);
      font-size: 12.5px;
      letter-spacing:.2px;
    }

    .pillRow{ display:flex; gap: var(--s-2); flex-wrap: wrap; }
    .pill{
      font-family: var(--font-mono);
      font-size: 16px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(8,8,14,.55);
      color: rgba(240,245,255,.86);
      box-shadow: var(--glow2);
      display:inline-flex;
      align-items:center;
      gap: 8px;
      user-select:none;
    }
    .pill .dot{
      width: 9px; height: 9px; border-radius: 50%;
      background: rgba(82,248,255,.7);
      box-shadow: 0 0 0 1px rgba(255,255,255,.10), 0 0 18px rgba(82,248,255,.35);
      animation: pulse 1.35s ease-in-out infinite;
    }
    .pill:nth-child(2) .dot{ background: rgba(255,77,243,.7); box-shadow: 0 0 18px rgba(255,77,243,.35); animation-delay:.18s;}
    .pill:nth-child(3) .dot{ background: rgba(164,107,255,.7); box-shadow: 0 0 18px rgba(164,107,255,.35); animation-delay:.32s;}
    @keyframes pulse{
      0%, 100%{ transform: scale(.92); opacity: .72; }
      50%{ transform: scale(1.18); opacity: 1; }
    }

    .teePanel{
      padding: var(--s-4);
      border-radius: var(--r-md);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(8,8,14,.42);
      box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset;
      overflow:hidden;
      position:relative;
    }
    .teePanel:before{
      content:"";
      position:absolute; inset:-1px;
      background: linear-gradient(120deg, rgba(82,248,255,.08), rgba(255,77,243,.06), rgba(164,107,255,.06));
      opacity:.6;
      pointer-events:none;
    }
    .teePanel > *{ position:relative; z-index:1; }

    .teeHeader{
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom: var(--s-3);
    }
    .teeHeader h2{
      margin:0;
      font-size: 13px;
      letter-spacing:.9px;
      text-transform: uppercase;
      color: rgba(240,245,255,.84);
    }
    .liveBadge{
      display:flex; align-items:center; gap:8px;
      font-family: var(--font-mono);
      font-size: 16px;
      color: rgba(240,245,255,.78);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.24);
    }
    .liveBadge .wave{
      width:10px; height:10px; border-radius: 50%;
      background: var(--good);
      box-shadow: 0 0 0 1px rgba(255,255,255,.10), 0 0 18px rgba(81,255,176,.30);
      position:relative;
    }
    .liveBadge .wave:after{
      content:"";
      position:absolute; inset:-10px;
      border-radius:999px;
      border: 1px solid rgba(81,255,176,.40);
      opacity: .55;
      animation: ping 1.55s ease-out infinite;
    }
    @keyframes ping{
      0%{ transform: scale(.35); opacity:.0;}
      25%{ opacity:.55;}
      100%{ transform: scale(1.3); opacity:0;}
    }

    .teeList{
      display:flex;
      flex-direction:column;
      gap: var(--s-2);
    }
    .teeItem{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: var(--s-3);
      padding: 10px 12px;
      border-radius: var(--r-sm);
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.18);
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
    }
    .teeItem:hover{
      transform: translateY(-1px);
      border-color: rgba(82,248,255,.22);
      background: rgba(0,0,0,.24);
    }
    .teeLeft{
      display:flex;
      flex-direction:column;
      gap: 3px;
      min-width: 0;
    }
    .teeName{
      font-size: 13px;
      color: rgba(240,245,255,.86);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .teeDesc{
      font-family: var(--font-mono);
      font-size: 15px;
      color: rgba(240,245,255,.60);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .teeRight{
      display:flex; align-items:center; gap: 10px; flex:0 0 auto;
      font-family: var(--font-mono);
      font-size: 16px;
    }
    .statusIcon{
      width: 26px; height: 26px;
      border-radius: 10px;
      display:grid; place-items:center;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      position:relative;
      overflow:hidden;
    }
    .statusIcon:before{
      content:"";
      position:absolute; inset:-40%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.16), transparent 55%);
      transform: rotate(20deg);
    }
    .ok .statusIcon{ border-color: rgba(81,255,176,.28); box-shadow: 0 0 22px rgba(81,255,176,.10); }
    .bad .statusIcon{ border-color: rgba(255,77,125,.30); box-shadow: 0 0 22px rgba(255,77,125,.10); }
    .ok .statusText{ color: rgba(81,255,176,.95); }
    .bad .statusText{ color: rgba(255,77,125,.92); }
    .statusText{
      letter-spacing: .2px;
    }

    .how{
      padding: var(--s-4);
      border-radius: var(--r-md);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(8,8,14,.42);
      box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset;
    }
    .how h3{
      margin:0 0 var(--s-3) 0;
      font-size: 13px;
      letter-spacing:.9px;
      text-transform: uppercase;
      color: rgba(240,245,255,.84);
    }
    .steps{
      display:flex;
      flex-direction:column;
      gap: var(--s-3);
      margin:0;
      padding:0;
      list-style:none;
    }
    .step{
      display:flex;
      gap: var(--s-3);
      align-items:flex-start;
    }
    .stepNum{
      width: 28px; height: 28px;
      border-radius: 12px;
      display:grid; place-items:center;
      font-family: var(--font-mono);
      font-size: 18px;
      color: rgba(240,245,255,.85);
      border: 1px solid rgba(82,248,255,.22);
      background: rgba(0,0,0,.18);
      box-shadow: 0 0 18px rgba(82,248,255,.10);
      flex: 0 0 auto;
    }
    .stepText{
      font-size: 12.8px;
      color: rgba(240,245,255,.72);
      line-height: 1.35;
    }
    .code{
      margin-top: var(--s-4);
      border-radius: var(--r-md);
      border: 1px solid rgba(255,255,255,.12);
      overflow:hidden;
      background: rgba(0,0,0,.26);
    }
    .codeHeader{
      display:flex; align-items:center; justify-content:space-between;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .codeHeader .label{
      font-size: 12px;
      letter-spacing:.9px;
      text-transform: uppercase;
      color: rgba(240,245,255,.72);
    }
    .btn{
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      color: rgba(240,245,255,.88);
      border-radius: 12px;
      padding: 9px 12px;
      font-family: var(--font-display);
      font-size: 12.8px;
      cursor:pointer;
      transition: transform .16s ease, border-color .16s ease, background .16s ease, box-shadow .16s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(82,248,255,.28); box-shadow: 0 0 0 1px rgba(82,248,255,.14) inset, 0 14px 26px rgba(0,0,0,.35); }
    .btn:active{ transform: translateY(0px) scale(.99); }
    .btn:focus{ outline:none; box-shadow: var(--ring), 0 14px 26px rgba(0,0,0,.35); }
    .btn.secondary{
      background: rgba(0,0,0,.18);
    }

    pre{
      margin:0;
      padding: 14px 14px;
      font-family: var(--font-mono);
      font-size: 18px;
      line-height: 1.2;
      color: rgba(240,245,255,.86);
      overflow:auto;
      white-space:pre;
    }
    .kw{ color: var(--cyan); }
    .cm{ color: rgba(240,245,255,.54); }
    .st{ color: rgba(81,255,176,.92); }
    .fn{ color: rgba(255,219,110,.92); }
    .id{ color: rgba(164,107,255,.92); }

    .main{
      flex:1;
      min-width:0;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: var(--s-4);
      padding: var(--s-5);
      margin-bottom: var(--s-4);
    }
    .topbar .meta{
      display:flex;
      flex-direction:column;
      gap: var(--s-2);
      min-width:0;
    }
    .topbar .meta .big{
      margin:0;
      font-size: 20px;
      letter-spacing:.2px;
    }
    .topbar .meta .small{
      margin:0;
      font-size: 12.8px;
      color: var(--muted);
      line-height: 1.35;
    }
    .topbar .actions{ display:flex; gap: var(--s-2); flex-wrap:wrap; justify-content:flex-end; }

    .chatShell{
      flex:1;
      min-height:0;
      padding: 0 var(--s-5) var(--s-4);
      display:flex;
      flex-direction:column;
      gap: var(--s-3);
    }
    .chat{
      flex:1;
      min-height:0;
      border-radius: var(--r-lg);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(8,8,14,.40);
      box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset, var(--shadow2);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .chatHeader{
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    }
    .chatHeader .left{
      display:flex; align-items:center; gap: 10px;
      min-width:0;
    }
    .chip{
      font-family: var(--font-mono);
      font-size: 16px;
      color: rgba(240,245,255,.78);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      display:inline-flex; gap:8px; align-items:center;
    }
    .chip .miniDot{
      width: 8px; height: 8px; border-radius: 50%;
      background: rgba(82,248,255,.8);
      box-shadow: 0 0 18px rgba(82,248,255,.35);
      animation: pulse 1.35s ease-in-out infinite;
    }
    .chatHeader .right{
      display:flex; align-items:center; gap: 10px;
      font-family: var(--font-mono);
      font-size: 16px;
      color: rgba(240,245,255,.60);
    }

    .scroll{
      flex:1;
      min-height:0;
      overflow:auto;
      padding: var(--s-4);
      scroll-behavior:smooth;
    }

    .welcome{
      border: 1px solid rgba(82,248,255,.18);
      background: linear-gradient(180deg, rgba(82,248,255,.08), rgba(255,77,243,.05));
      border-radius: var(--r-lg);
      padding: var(--s-5);
      box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset, 0 18px 60px rgba(0,0,0,.35);
      position:relative;
      overflow:hidden;
      animation: popIn .35s ease both;
    }
    .welcome:before{
      content:"";
      position:absolute; inset:-30%;
      background: conic-gradient(from 140deg, rgba(82,248,255,.0), rgba(82,248,255,.18), rgba(255,77,243,.14), rgba(164,107,255,.10), rgba(82,248,255,.0));
      animation: spin 7.2s linear infinite;
      opacity:.55;
      filter: blur(10px);
    }
    .welcome > *{ position:relative; z-index:1; }
    .welcome h4{
      margin: 0 0 var(--s-2);
      font-size: 20px;
      letter-spacing:.2px;
    }
    .welcome p{
      margin: 0;
      color: rgba(240,245,255,.72);
      font-size: 13px;
      line-height: 1.45;
      max-width: 70ch;
    }
    .welcome .bullets{
      margin-top: var(--s-4);
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--s-3);
    }
    .b{
      padding: 12px 12px;
      border-radius: var(--r-md);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      color: rgba(240,245,255,.78);
      font-size: 12.6px;
      line-height:1.35;
      transition: transform .16s ease, border-color .16s ease;
    }
    .b strong{ color: rgba(240,245,255,.92); font-weight: 600;}
    .b:hover{ transform: translateY(-1px); border-color: rgba(82,248,255,.22); }

    .welcome.hidden{ display:none !important; }

    .messages{
      display:flex;
      flex-direction:column;
      gap: var(--s-3);
      padding-bottom: var(--s-2);
    }

    .msg{
      display:flex;
      gap: 12px;
      align-items:flex-end;
      max-width: 100%;
      animation: msgIn .22s ease both;
    }
    @keyframes msgIn{
      from{ opacity:0; transform: translateY(10px) scale(.99); filter: blur(2px); }
      to{ opacity:1; transform: translateY(0) scale(1); filter: blur(0); }
    }
    .avatar{
      width: 36px; height: 36px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      display:grid; place-items:center;
      box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset;
      flex: 0 0 auto;
      position:relative;
      overflow:hidden;
    }
    .avatar:after{
      content:"";
      position:absolute; inset:-40%;
      background: radial-gradient(circle at 30% 30%, rgba(82,248,255,.18), transparent 55%),
                  radial-gradient(circle at 75% 65%, rgba(255,77,243,.14), transparent 58%);
      filter: blur(8px);
      opacity:.95;
    }
    .avatar span{
      position:relative;
      z-index:1;
      font-family: var(--font-mono);
      font-size: 20px;
      color: rgba(240,245,255,.86);
    }

    .bubble{
      border-radius: 18px;
      padding: 12px 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset;
      max-width: min(720px, 100%);
      position:relative;
      overflow:hidden;
      transition: transform .16s ease, border-color .16s ease, background .16s ease;
    }
    .bubble:hover{
      transform: translateY(-1px);
      border-color: rgba(82,248,255,.22);
      background: rgba(0,0,0,.24);
    }

    .msg.user{ flex-direction: row-reverse; }
    .msg.user .bubble{
      background: linear-gradient(180deg, rgba(82,248,255,.10), rgba(0,0,0,.18));
      border-color: rgba(82,248,255,.18);
    }
    .msg.user .avatar:after{
      background: radial-gradient(circle at 30% 30%, rgba(81,255,176,.18), transparent 55%),
                  radial-gradient(circle at 75% 65%, rgba(82,248,255,.14), transparent 58%);
    }

    .text{
      white-space:pre-wrap;
      word-wrap:break-word;
      font-size: 13.2px;
      color: rgba(240,245,255,.88);
      line-height:1.45;
    }

    .metaRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,.08);
      color: rgba(240,245,255,.58);
      font-size: 12px;
    }
    .badge{
      display:inline-flex; align-items:center; gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      font-family: var(--font-mono);
      font-size: 16px;
      color: rgba(240,245,255,.70);
      box-shadow: 0 0 18px rgba(82,248,255,.08);
    }
    .lock{
      width: 10px; height: 10px;
      border-radius: 50%;
      background: rgba(81,255,176,.86);
      box-shadow: 0 0 18px rgba(81,255,176,.35);
      animation: pulse 1.35s ease-in-out infinite;
    }
    .time{
      font-family: var(--font-mono);
      font-size: 16px;
      color: rgba(240,245,255,.52);
      white-space:nowrap;
    }

    .typing{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px dashed rgba(255,255,255,.16);
      background: rgba(0,0,0,.16);
      max-width: 360px;
      animation: msgIn .22s ease both;
    }
    .typing .dots{
      display:flex;
      gap: 6px;
      align-items:center;
    }
    .typing .dots span{
      width: 8px; height: 8px; border-radius: 50%;
      background: rgba(240,245,255,.70);
      opacity:.55;
      animation: bounce 1s ease-in-out infinite;
    }
    .typing .dots span:nth-child(2){ animation-delay:.12s; opacity:.45;}
    .typing .dots span:nth-child(3){ animation-delay:.24s; opacity:.35;}
    @keyframes bounce{
      0%, 100%{ transform: translateY(0px); }
      50%{ transform: translateY(-6px); }
    }
    .typing .label{
      font-family: var(--font-mono);
      font-size: 16px;
      color: rgba(240,245,255,.64);
    }

    .composerWrap{
      margin-top: var(--s-3);
      border-radius: var(--r-lg);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(8,8,14,.48);
      box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset, var(--shadow2);
      overflow:hidden;
    }
    .composer{
      display:flex;
      gap: var(--s-2);
      padding: var(--s-3);
      align-items:flex-end;
    }
    textarea{
      flex:1;
      min-height: 46px;
      max-height: 160px;
      resize:none;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      color: rgba(240,245,255,.88);
      border-radius: 16px;
      padding: 12px 12px;
      font-family: var(--font-display);
      font-size: 13.2px;
      line-height: 1.35;
      outline:none;
      transition: box-shadow .16s ease, border-color .16s ease, transform .16s ease;
    }
    textarea:focus{
      border-color: rgba(82,248,255,.30);
      box-shadow: var(--ring);
      transform: translateY(-1px);
    }
    .sendBtn{
      flex: 0 0 auto;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(82,248,255,.22);
      background: linear-gradient(180deg, rgba(82,248,255,.16), rgba(0,0,0,.14));
      color: rgba(240,245,255,.90);
      font-weight: 600;
      letter-spacing:.2px;
      cursor:pointer;
      transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease;
      box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset;
      min-width: 98px;
    }
    .sendBtn:hover{
      transform: translateY(-1px);
      border-color: rgba(255,77,243,.26);
      box-shadow: 0 0 0 1px rgba(82,248,255,.14) inset, 0 18px 40px rgba(0,0,0,.45), 0 0 40px rgba(82,248,255,.10);
    }
    .sendBtn:active{ transform: translateY(0px) scale(.99); }
    .sendBtn:disabled{
      cursor:not-allowed;
      opacity:.55;
      transform:none;
      box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset;
    }

    .composerFooter{
      padding: 10px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border-top: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: rgba(240,245,255,.62);
      font-size: 12.3px;
    }
    .composerFooter .left{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width:0;
    }
    .miniNote{
      display:flex; align-items:center; gap: 8px;
      font-family: var(--font-mono);
      font-size: 16px;
      color: rgba(240,245,255,.60);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .kbd{
      font-family: var(--font-mono);
      font-size: 16px;
      padding: 3px 8px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: rgba(240,245,255,.72);
      box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset;
      white-space:nowrap;
    }

    .toastWrap{
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      display:flex;
      flex-direction:column;
      gap: 10px;
      z-index: 9999;
      pointer-events:none;
      width: min(760px, calc(100% - 24px));
    }
    .toast{
      pointer-events:none;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(8,8,14,.72);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      box-shadow: 0 22px 70px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.06) inset;
      padding: 12px 14px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      animation: toastIn .26s ease both;
    }
    @keyframes toastIn{
      from{ opacity:0; transform: translateY(10px) scale(.99); filter: blur(3px); }
      to{ opacity:1; transform: translateY(0) scale(1); filter: blur(0); }
    }
    .toast .tTitle{
      font-size: 13px;
      font-weight: 700;
      margin:0 0 2px 0;
      color: rgba(240,245,255,.88);
    }
    .toast .tBody{
      margin:0;
      font-size: 12.6px;
      color: rgba(240,245,255,.70);
      line-height:1.35;
    }
    .toast .tag{
      font-family: var(--font-mono);
      font-size: 16px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      color: rgba(240,245,255,.72);
      white-space:nowrap;
    }
    .tag.good{ border-color: rgba(81,255,176,.22); }
    .tag.bad{ border-color: rgba(255,77,125,.22); }

    /* Responsive */
    @media (max-width: 980px){
      body{ overflow:auto; }
      .bg{ position:fixed; }
      .app{
        flex-direction:column;
        overflow:visible;
      }
      .sidebar{
        width:100%;
        max-width:none;
      }
      .main{
        height: calc(100vh - 24px);
        min-height: 560px;
      }
      .welcome .bullets{
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 520px){
      .topbar{ padding: var(--s-4); }
      .chatShell{ padding: 0 var(--s-4) var(--s-4); }
      .sidebar{ padding: var(--s-4); }
      .bubble{ padding: 11px 11px; }
      .sendBtn{ min-width: 90px; }
      .brand{ flex-direction:row; align-items:flex-start; }
    }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true">
    <div class="mesh"></div>
    <div class="grid"></div>
    <div class="vignette"></div>
  </div>

  <div class="app">
    <aside class="sidebar card" aria-label="TEE status and how it works">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M12 2l8 4.5v6.8c0 5.4-4.2 8.6-8 9.7-3.8-1.1-8-4.3-8-9.7V6.5L12 2z" stroke="rgba(240,245,255,.86)" stroke-width="1.6"/>
            <path d="M8.5 12.1l2.2 2.3 4.8-5.1" stroke="rgba(81,255,176,.92)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="title">
          <div class="h1">TEE Private Chat</div>
          <div class="sub">Enterprise-grade cryptographic privacy â€” trivially simple to build.</div>
          <div class="pillRow" aria-label="Live runtime signals">
            <div class="pill"><span class="dot"></span>TEE LIVE</div>
            <div class="pill"><span class="dot"></span>NEAR AI Cloud</div>
            <div class="pill"><span class="dot"></span>Operator Blind</div>
          </div>
        </div>
      </div>

      <section class="teePanel" aria-label="Live TEE status indicators">
        <div class="teeHeader">
          <h2>TEE Status</h2>
          <div class="liveBadge" title="Signals update live (simulated monitoring)">
            <span class="wave"></span>
            LIVE
          </div>
        </div>

        <div class="teeList">
          <div class="teeItem ok">
            <div class="teeLeft">
              <div class="teeName">Encryption</div>
              <div class="teeDesc">AES-256-GCM</div>
            </div>
            <div class="teeRight">
              <div class="statusText">âœ“</div>
              <div class="statusIcon" aria-hidden="true">
                <span style="position:relative; z-index:1; font-family: var(--font-mono); font-size: 18px; color: rgba(81,255,176,.92);">E</span>
              </div>
            </div>
          </div>

          <div class="teeItem ok">
            <div class="teeLeft">
              <div class="teeName">Attestation</div>
              <div class="teeDesc">Verified</div>
            </div>
            <div class="teeRight">
              <div class="statusText">âœ“</div>
              <div class="statusIcon" aria-hidden="true">
                <span style="position:relative; z-index:1; font-family: var(--font-mono); font-size: 18px; color: rgba(81,255,176,.92);">A</span>
              </div>
            </div>
          </div>

          <div class="teeItem bad" id="operatorAccessRow">
            <div class="teeLeft">
              <div class="teeName">Operator Access</div>
              <div class="teeDesc">BLOCKED</div>
            </div>
            <div class="teeRight">
              <div class="statusText">âœ—</div>
              <div class="statusIcon" aria-hidden="true">
                <span style="position:relative; z-index:1; font-family: var(--font-mono); font-size: 18px; color: rgba(255,77,125,.92);">X</span>
              </div>
            </div>
          </div>

          <div class="teeItem ok">
            <div class="teeLeft">
              <div class="teeName">Inference</div>
              <div class="teeDesc">On-Chain TEE</div>
            </div>
            <div class="teeRight">
              <div class="statusText">âœ“</div>
              <div class="statusIcon" aria-hidden="true">
                <span style="position:relative; z-index:1; font-family: var(--font-mono); font-size: 18px; color: rgba(81,255,176,.92);">I</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="how" aria-label="How it works">
        <h3>How It Works</h3>
        <ul class="steps">
          <li class="step">
            <div class="stepNum">1</div>
            <div class="stepText">You type a prompt. Itâ€™s encrypted in transit and processed inside a hardware-isolated Trusted Execution Environment (TEE).</div>
          </li>
          <li class="step">
            <div class="stepNum">2</div>
            <div class="stepText">Remote attestation proves the enclave is genuine and running approved code â€” before it touches your data.</div>
          </li>
          <li class="step">
            <div class="stepNum">3</div>
            <div class="stepText">Server operators canâ€™t read prompts or responses â€” memory is protected and access is cryptographically blocked.</div>
          </li>
          <li class="step">
            <div class="stepNum">4</div>
            <div class="stepText">You get an answer with an auditable privacy story: enterprise-grade security, developer-simple integration.</div>
          </li>
        </ul>

        <div class="code" aria-label="NEAR AI Cloud integration snippet">
          <div class="codeHeader">
            <div class="label">3-line NEAR AI Cloud integration</div>
            <button class="btn secondary" id="copyCodeBtn" type="button">Copy</button>
          </div>
          <pre id="codeBlock"><span class="kw">const</span> <span class="id">ai</span> <span class="kw">=</span> <span class="kw">new</span> <span class="fn">OpenAI</span>({ <span class="id">baseURL</span>: <span class="st">'https://cloud-api.near.ai/v1'</span>, <span class="id">apiKey</span>: <span class="id">YOUR_KEY</span> })
<span class="cm">// TEE protection is automatic. No special SDK needed.</span></pre>
        </div>
      </section>
    </aside>

    <main class="main card" aria-label="Private chat">
      <header class="topbar">
        <div class="meta">
          <h1 class="big" style="margin:0;">Cryptographically Private AI Chat</h1>
          <p class="small">Your prompts are processed in a TEE. The operator canâ€™t see them â€” not even with root access. Ask sensitive questions with confidence.</p>
        </div>
        <div class="actions">
          <button class="btn" id="newChatBtn" type="button" title="Clear this chat">New Chat</button>
          <button class="btn secondary" id="exportBtn" type="button" title="Download chat transcript">Export</button>
        </div>
      </header>

      <section class="chatShell">
        <div class="chat" role="region" aria-label="Chat transcript">
          <div class="chatHeader">
            <div class="left">
              <div class="chip" title="TEE-secured session">
                <span class="miniDot"></span>
                Session: TEE-secured
              </div>
              <div class="chip" title="Model">
                <span style="opacity:.85;">Model</span>
                <strong style="color:rgba(240,245,255,.84); font-weight:600;">DeepSeek-V3.1</strong>
              </div>
            </div>
            <div class="right">
              <span id="netStatus">Network: ready</span>
            </div>
          </div>

          <div class="scroll" id="scroll">
            <div class="welcome" id="welcome">
              <h4>Welcome to Operator-Blind Chat</h4>
              <p>
                This chat demonstrates a simple truth: <strong>privacy can be enterprise-grade without being complicated</strong>.
                Messages are sent to NEAR AI Cloud and handled in a Trusted Execution Environment (TEE).
              </p>
              <div class="bullets">
                <div class="b"><strong>What you type</strong> stays cryptographically protected while processed.</div>
                <div class="b"><strong>Operator access</strong> is blocked â€” your prompts arenâ€™t readable by server admins.</div>
                <div class="b"><strong>Attestation</strong> proves the enclave is genuine before inference.</div>
                <div class="b"><strong>Integration</strong> is just a normal API call â€” no special SDK.</div>
              </div>
            </div>

            <div class="messages" id="messages" aria-live="polite" aria-relevant="additions"></div>
          </div>
        </div>

        <div class="composerWrap" aria-label="Message composer">
          <form class="composer" id="composer">
            <textarea id="input" placeholder="Ask something sensitiveâ€¦ (Shift+Enter for newline)" autocomplete="off" spellcheck="false"></textarea>
            <button class="sendBtn" id="sendBtn" type="submit">Send</button>
          </form>
          <div class="composerFooter">
            <div class="left">
              <div class="miniNote"><span class="lock"></span> TEE-secured Â· NEAR AI Cloud</div>
              <span class="kbd" title="Keyboard shortcut">Enter</span>
              <span style="color:rgba(240,245,255,.52)">send</span>
              <span class="kbd" title="Keyboard shortcut">Shift</span>+<span class="kbd" title="Keyboard shortcut">Enter</span>
              <span style="color:rgba(240,245,255,.52)">newline</span>
            </div>
            <div class="right" style="display:flex; align-items:center; gap:10px;">
              <span class="kbd" id="tokenHint" title="Token budget (approx)">max_tokens: 1024</span>
              <button class="btn secondary" id="privacyBtn" type="button" title="Explain privacy promise">Privacy promise</button>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div class="toastWrap" id="toasts" aria-live="polite" aria-relevant="additions"></div>

  <script>
    (function(){
      const ENDPOINT = "https://cloud-api.near.ai/v1/chat/completions";
      const MODEL = "deepseek-ai/DeepSeek-V3.1";
      const AUTH = "Bearer sk-158842bdda7b4d13857e201777c11dc7";

      const els = {
        scroll: document.getElementById('scroll'),
        messages: document.getElementById('messages'),
        welcome: document.getElementById('welcome'),
        composer: document.getElementById('composer'),
        input: document.getElementById('input'),
        sendBtn: document.getElementById('sendBtn'),
        netStatus: document.getElementById('netStatus'),
        newChatBtn: document.getElementById('newChatBtn'),
        exportBtn: document.getElementById('exportBtn'),
        privacyBtn: document.getElementById('privacyBtn'),
        copyCodeBtn: document.getElementById('copyCodeBtn'),
        codeBlock: document.getElementById('codeBlock'),
        toasts: document.getElementById('toasts'),
        operatorAccessRow: document.getElementById('operatorAccessRow')
      };

      const state = {
        messages: [],
        pending: false,
        typingEl: null,
        lastNetworkOk: true
      };

      const storageKey = "tee_private_chat_v1";

      function nowTime(){
        const d = new Date();
        return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
      }

      function escapeHtml(str){
        return str
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#039;");
      }

      function toast(title, body, kind){
        const t = document.createElement('div');
        t.className = 'toast';
        const tagText = kind === 'bad' ? 'ALERT' : (kind === 'good' ? 'OK' : 'INFO');
        const tagClass = kind === 'bad' ? 'tag bad' : (kind === 'good' ? 'tag good' : 'tag');
        t.innerHTML = `
          <div style="min-width:0;">
            <p class="tTitle">${escapeHtml(title)}</p>
            <p class="tBody">${escapeHtml(body)}</p>
          </div>
          <div class="${tagClass}">${escapeHtml(tagText)}</div>
        `;
        els.toasts.appendChild(t);
        setTimeout(()=> {
          t.style.transition = "opacity .25s ease, transform .25s ease, filter .25s ease";
          t.style.opacity = "0";
          t.style.transform = "translateY(8px) scale(.99)";
          t.style.filter = "blur(2px)";
          setTimeout(()=> t.remove(), 280);
        }, 3200);
      }

      function setNetStatus(text, ok){
        els.netStatus.textContent = text;
        if(ok === false){
          els.netStatus.style.color = "rgba(255,77,125,.82)";
        } else if(ok === true){
          els.netStatus.style.color = "rgba(81,255,176,.82)";
        } else {
          els.netStatus.style.color = "rgba(240,245,255,.60)";
        }
      }

      function scrollToBottom(){
        requestAnimationFrame(()=>{
          els.scroll.scrollTop = els.scroll.scrollHeight;
        });
      }

      function hideWelcome(){
        if(!els.welcome.classList.contains('hidden')){
          els.welcome.classList.add('hidden');
        }
      }

      function addTyping(){
        removeTyping();
        const wrap = document.createElement('div');
        wrap.className = 'msg assistant';
        wrap.innerHTML = `
          <div class="avatar" aria-hidden="true"><span>âˆ¿</span></div>
          <div class="typing" role="status" aria-label="Assistant is typing">
            <div class="dots" aria-hidden="true"><span></span><span></span><span></span></div>
            <div class="label">TEE enclave is thinkingâ€¦</div>
          </div>
        `;
        els.messages.appendChild(wrap);
        state.typingEl = wrap;
        scrollToBottom();
      }

      function removeTyping(){
        if(state.typingEl){
          state.typingEl.remove();
          state.typingEl = null;
        }
      }

      function addMessage(role, content, opts={}){
        const msg = { role, content, t: new Date().toISOString(), id: crypto.randomUUID() };
        if(opts.persist !== false){
          state.messages.push(msg);
          save();
        }

        const el = document.createElement('div');
        el.className = 'msg ' + (role === 'user' ? 'user' : 'assistant');
        const av = role === 'user' ? 'You' : 'âˆ¿';
        const safe = escapeHtml(content);

        let badgeHtml = '';
        if(role !== 'user'){
          badgeHtml = `
            <div class="metaRow">
              <div class="badge" title="Processed inside a Trusted Execution Environment via NEAR AI Cloud">
                <span class="lock"></span>
                ðŸ”’ TEE-secured Â· NEAR AI Cloud
              </div>
              <div class="time">${escapeHtml(nowTime())}</div>
            </div>
          `;
        } else {
          badgeHtml = `
            <div class="metaRow">
              <div class="badge" title="Encrypted prompt to TEE">
                <span class="lock"></span>
                Encrypted to TEE
              </div>
              <div class="time">${escapeHtml(nowTime())}</div>
            </div>
          `;
        }

        el.innerHTML = `
          <div class="avatar" aria-hidden="true"><span>${escapeHtml(av)}</span></div>
          <div class="bubble">
            <div class="text">${safe}</div>
            ${badgeHtml}
          </div>
        `;

        els.messages.appendChild(el);
        scrollToBottom();
      }

      function systemPrompt(){
        return `You are a privacy-first assistant running inside a Trusted Execution Environment (TEE) via NEAR AI Cloud.
Core narrative requirements:
- Emphasize that prompts/responses are processed in a TEE; server operators cannot view plaintext.
- Keep explanations plain-English and enterprise-friendly.
- If the user asks about "attestation", explain it simply (proof the enclave is genuine).
Style:
- Clear, concise, helpful. Provide steps/checklists where useful.
- Avoid claiming absolute guarantees; say "designed so that" / "cryptographically enforced" and note that network/client environment still matters.`;
      }

      function buildPayload(){
        const msgs = [
          { role: "system", content: systemPrompt() },
          ...state.messages.map(m => ({ role: m.role, content: m.content }))
        ];
        return { model: MODEL, messages: msgs, max_tokens: 1024 };
      }

      async function callNearAI(){
        const payload = buildPayload();
        const resp = await fetch(ENDPOINT, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": AUTH
          },
          body: JSON.stringify(payload)
        });

        let data;
        try{
          data = await resp.json();
        } catch(e){
          throw new Error("Non-JSON response from NEAR AI Cloud.");
        }

        if(!resp.ok){
          const msg = (data && data.error && (data.error.message || data.error)) ? (data.error.message || data.error) : ("HTTP " + resp.status);
          throw new Error(msg);
        }

        const out = data?.choices?.[0]?.message?.content;
        if(typeof out !== "string" || !out.trim()){
          throw new Error("Empty response from model.");
        }
        return out.trim();
      }

      function save(){
        try{
          localStorage.setItem(storageKey, JSON.stringify({ messages: state.messages }));
        }catch(e){}
      }

      function load(){
        try{
          const raw = localStorage.getItem(storageKey);
          if(!raw) return;
          const parsed = JSON.parse(raw);
          if(!parsed || !Array.isArray(parsed.messages)) return;
          state.messages = parsed.messages.filter(m => m && (m.role === "user" || m.role === "assistant") && typeof m.content === "string");
        }catch(e){}
      }

      function renderFromState(){
        els.messages.innerHTML = "";
        if(state.messages.length > 0) hideWelcome();
        for(const m of state.messages){
          addMessage(m.role, m.content, { persist:false });
        }
        scrollToBottom();
      }

      function setPending(p){
        state.pending = p;
        els.sendBtn.disabled = p;
        els.input.disabled = p;
        if(p){
          setNetStatus("Network: requestingâ€¦", null);
        } else {
          setNetStatus("Network: ready", true);
        }
      }

      function autosize(){
        const ta = els.input;
        ta.style.height = "0px";
        const h = Math.min(160, Math.max(46, ta.scrollHeight));
        ta.style.height = h + "px";
      }

      async function onSend(){
        const text = (els.input.value || "").trim();
        if(!text) return;

        hideWelcome();
        addMessage("user", text);
        els.input.value = "";
        autosize();

        setPending(true);
        addTyping();

        // subtle operator access "blocked" shimmer to reinforce narrative
        els.operatorAccessRow.style.transition = "transform .18s ease, filter .18s ease";
        els.operatorAccessRow.style.filter = "drop-shadow(0 0 18px rgba(255,77,125,.12))";
        setTimeout(()=> els.operatorAccessRow.style.filter = "", 450);

        try{
          const out = await callNearAI();
          removeTyping();
          addMessage("assistant", out);
          setNetStatus("Network: secure response", true);
          state.lastNetworkOk = true;
        }catch(err){
          removeTyping();
          setNetStatus("Network: error", false);
          state.lastNetworkOk = false;
          const msg = (err && err.message) ? err.message : String(err);

          addMessage("assistant",
            "I couldnâ€™t reach NEAR AI Cloud right now.\n\n" +
            "What this means:\n" +
            "â€¢ Your message wasnâ€™t successfully processed.\n" +
            "â€¢ If the request failed before inference, the enclave never saw it.\n\n" +
            "Error details:\n" + msg
          );

          toast("Request failed", "Couldnâ€™t fetch a response from NEAR AI Cloud. Check your key/network and try again.", "bad");
        }finally{
          setPending(false);
          els.input.focus();
        }
      }

      function newChat(){
        if(state.pending) return;
        state.messages = [];
        save();
        els.messages.innerHTML = "";
        els.welcome.classList.remove('hidden');
        setNetStatus("Network: ready", true);
        toast("New chat", "Transcript cleared locally. TEE privacy remains automatic.", "good");
        els.input.focus();
      }

      function exportChat(){
        const lines = [];
        lines.push("TEE Private Chat Â· NEAR AI Cloud");
        lines.push("Exported: " + new Date().toISOString());
        lines.push("Note: Assistant replies were processed in a TEE; operator access is blocked by design.\n");
        for(const m of state.messages){
          const who = m.role === "user" ? "You" : "Assistant (TEE-secured Â· NEAR AI Cloud)";
          lines.push(`[${m.t}] ${who}:\n${m.content}\n`);
        }
        const blob = new Blob([lines.join("\n")], {type:"text/plain;charset=utf-8"});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = "tee-private-chat.txt";
        document.body.appendChild(a);
        a.click();
        setTimeout(()=> {
          URL.revokeObjectURL(a.href);
          a.remove();
        }, 0);
        toast("Exported", "Downloaded a local transcript file.", "good");
      }

      function showPrivacyPromise(){
        const text =
`Privacy promise (plain English):
â€¢ Your prompts are sent to NEAR AI Cloud and intended to be processed inside a Trusted Execution Environment (TEE).
â€¢ The TEE uses hardware-backed isolation and encryption so server operators are designed to be unable to see plaintext prompts/responses.
â€¢ Attestation can prove the enclave is genuine and running approved code before it handles data.
â€¢ Important: your browser/device and network environment still matter â€” protect your endpoint, and avoid pasting secrets on compromised devices.`;
        addMessage("assistant", text);
        hideWelcome();
        scrollToBottom();
      }

      async function copyCode(){
        const raw =
`const ai = new OpenAI({ baseURL: 'https://cloud-api.near.ai/v1', apiKey: YOUR_KEY })
// TEE protection is automatic. No special SDK needed.`;
        try{
          await navigator.clipboard.writeText(raw);
          toast("Copied", "Snippet copied to clipboard.", "good");
        }catch(e){
          toast("Copy failed", "Clipboard permission blocked. Select and copy manually.", "bad");
        }
      }

      // Events
      els.composer.addEventListener('submit', (e)=>{
        e.preventDefault();
        if(state.pending) return;
        onSend();
      });

      els.input.addEventListener('input', autosize);

      els.input.addEventListener('keydown', (e)=>{
        if(e.key === "Enter" && !e.shiftKey){
          e.preventDefault();
          if(state.pending) return;
          onSend();
        }
      });

      els.newChatBtn.addEventListener('click', newChat);
      els.exportBtn.addEventListener('click', exportChat);
      els.privacyBtn.addEventListener('click', showPrivacyPromise);
      els.copyCodeBtn.addEventListener('click', copyCode);

      // Startup
      load();
      renderFromState();
      autosize();
      setNetStatus("Network: ready", true);

      // Initial nudge if empty
      if(state.messages.length === 0){
        setTimeout(()=>{
          toast("Tip", "Ask about handling sensitive data, compliance, or how attestation works.", "info");
        }, 650);
      }

      // Live-ish status shimmer animation loop (subtle) to imply monitoring
      let shimmerT = 0;
      function shimmer(){
        shimmerT += 1;
        const a = (Math.sin(shimmerT/22) + 1)/2; // 0..1
        const border = 0.10 + a*0.16;
        els.operatorAccessRow.style.borderColor = `rgba(255,77,125,${border})`;
        requestAnimationFrame(shimmer);
      }
      shimmer();

      // If the key placeholder is still present, warn (deployment replaces it)
      if(AUTH.includes("sk-158842bdda7b4d13857e201777c11dc7")){
        setTimeout(()=>{
          toast("Deploy note", "API key placeholder detected. At deploy time it will be replaced automatically.", "info");
        }, 1200);
      }
    })();
  </script>
</body>
</html>